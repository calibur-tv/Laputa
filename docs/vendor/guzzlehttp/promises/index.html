<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guzzle Promises | Hello VuePress</title>
    <meta name="description" content="Just playing around">
    <link rel="icon" href="https://static.calibur.tv/favicon.ico">
    
    <link rel="preload" href="Laputa/assets/css/0.styles.21b3d02c.css" as="style"><link rel="preload" href="Laputa/assets/js/app.6f999ec1.js" as="script"><link rel="preload" href="Laputa/assets/js/47.53bc0ff4.js" as="script"><link rel="prefetch" href="Laputa/assets/js/127.5d5c2a9e.js"><link rel="prefetch" href="Laputa/assets/js/2.cda51ec0.js"><link rel="prefetch" href="Laputa/assets/js/3.a88ade89.js"><link rel="prefetch" href="Laputa/assets/js/4.f0a47b5a.js"><link rel="prefetch" href="Laputa/assets/js/5.eb4e2f15.js"><link rel="prefetch" href="Laputa/assets/js/6.ae349cfe.js"><link rel="prefetch" href="Laputa/assets/js/7.d8abf350.js"><link rel="prefetch" href="Laputa/assets/js/8.7660bbc3.js"><link rel="prefetch" href="Laputa/assets/js/9.9282dabe.js"><link rel="prefetch" href="Laputa/assets/js/10.ea22ba46.js"><link rel="prefetch" href="Laputa/assets/js/11.ed71705a.js"><link rel="prefetch" href="Laputa/assets/js/12.bab571ae.js"><link rel="prefetch" href="Laputa/assets/js/13.78fc55ea.js"><link rel="prefetch" href="Laputa/assets/js/14.765cca5f.js"><link rel="prefetch" href="Laputa/assets/js/15.7f1ee911.js"><link rel="prefetch" href="Laputa/assets/js/16.1de690fb.js"><link rel="prefetch" href="Laputa/assets/js/17.0c9bcfe7.js"><link rel="prefetch" href="Laputa/assets/js/18.4ea1b5ec.js"><link rel="prefetch" href="Laputa/assets/js/19.8c8f8b57.js"><link rel="prefetch" href="Laputa/assets/js/20.9129a22f.js"><link rel="prefetch" href="Laputa/assets/js/21.b84b104e.js"><link rel="prefetch" href="Laputa/assets/js/22.fe164d26.js"><link rel="prefetch" href="Laputa/assets/js/23.dee79d2c.js"><link rel="prefetch" href="Laputa/assets/js/24.7a76775e.js"><link rel="prefetch" href="Laputa/assets/js/25.57b548b0.js"><link rel="prefetch" href="Laputa/assets/js/26.22bea336.js"><link rel="prefetch" href="Laputa/assets/js/27.f372908a.js"><link rel="prefetch" href="Laputa/assets/js/28.7c33523e.js"><link rel="prefetch" href="Laputa/assets/js/29.0b631070.js"><link rel="prefetch" href="Laputa/assets/js/30.fde1b56c.js"><link rel="prefetch" href="Laputa/assets/js/31.19440d0b.js"><link rel="prefetch" href="Laputa/assets/js/32.09c05419.js"><link rel="prefetch" href="Laputa/assets/js/33.f24b2fa1.js"><link rel="prefetch" href="Laputa/assets/js/34.704234d2.js"><link rel="prefetch" href="Laputa/assets/js/35.3538aa16.js"><link rel="prefetch" href="Laputa/assets/js/36.9fd936b8.js"><link rel="prefetch" href="Laputa/assets/js/37.029a950c.js"><link rel="prefetch" href="Laputa/assets/js/38.ca2d406b.js"><link rel="prefetch" href="Laputa/assets/js/39.6d640b65.js"><link rel="prefetch" href="Laputa/assets/js/40.da4aa4d2.js"><link rel="prefetch" href="Laputa/assets/js/41.15815f6e.js"><link rel="prefetch" href="Laputa/assets/js/42.87b4655d.js"><link rel="prefetch" href="Laputa/assets/js/43.87956add.js"><link rel="prefetch" href="Laputa/assets/js/44.ed836e06.js"><link rel="prefetch" href="Laputa/assets/js/45.f6149b9c.js"><link rel="prefetch" href="Laputa/assets/js/46.57e569c9.js"><link rel="prefetch" href="Laputa/assets/js/48.e16402f6.js"><link rel="prefetch" href="Laputa/assets/js/49.ef4b9870.js"><link rel="prefetch" href="Laputa/assets/js/50.97b2795a.js"><link rel="prefetch" href="Laputa/assets/js/51.1df1f3d1.js"><link rel="prefetch" href="Laputa/assets/js/52.727e7778.js"><link rel="prefetch" href="Laputa/assets/js/53.f8356a1e.js"><link rel="prefetch" href="Laputa/assets/js/54.8f15ada1.js"><link rel="prefetch" href="Laputa/assets/js/55.fc41623e.js"><link rel="prefetch" href="Laputa/assets/js/56.b65567d0.js"><link rel="prefetch" href="Laputa/assets/js/57.3cb52983.js"><link rel="prefetch" href="Laputa/assets/js/58.ff69625f.js"><link rel="prefetch" href="Laputa/assets/js/59.b99f5762.js"><link rel="prefetch" href="Laputa/assets/js/60.b7c53f3f.js"><link rel="prefetch" href="Laputa/assets/js/61.2757576d.js"><link rel="prefetch" href="Laputa/assets/js/62.5d25765e.js"><link rel="prefetch" href="Laputa/assets/js/63.a6b7406e.js"><link rel="prefetch" href="Laputa/assets/js/64.7bba8fd1.js"><link rel="prefetch" href="Laputa/assets/js/65.6e593ebf.js"><link rel="prefetch" href="Laputa/assets/js/66.b926ddd2.js"><link rel="prefetch" href="Laputa/assets/js/67.c8c69cd3.js"><link rel="prefetch" href="Laputa/assets/js/68.cb4bb5cb.js"><link rel="prefetch" href="Laputa/assets/js/69.a7b09174.js"><link rel="prefetch" href="Laputa/assets/js/70.02c49833.js"><link rel="prefetch" href="Laputa/assets/js/71.1c53c636.js"><link rel="prefetch" href="Laputa/assets/js/72.bb0f586e.js"><link rel="prefetch" href="Laputa/assets/js/73.aa250a71.js"><link rel="prefetch" href="Laputa/assets/js/74.fcd8312b.js"><link rel="prefetch" href="Laputa/assets/js/75.ee561d5e.js"><link rel="prefetch" href="Laputa/assets/js/76.8d6c7d11.js"><link rel="prefetch" href="Laputa/assets/js/77.3c5c7747.js"><link rel="prefetch" href="Laputa/assets/js/78.0afb8d36.js"><link rel="prefetch" href="Laputa/assets/js/79.e09176dc.js"><link rel="prefetch" href="Laputa/assets/js/80.6add3555.js"><link rel="prefetch" href="Laputa/assets/js/81.46dfeac8.js"><link rel="prefetch" href="Laputa/assets/js/82.8c7bae69.js"><link rel="prefetch" href="Laputa/assets/js/83.3c1031f4.js"><link rel="prefetch" href="Laputa/assets/js/84.5414c057.js"><link rel="prefetch" href="Laputa/assets/js/85.434414f7.js"><link rel="prefetch" href="Laputa/assets/js/86.032ff5b5.js"><link rel="prefetch" href="Laputa/assets/js/87.1387e175.js"><link rel="prefetch" href="Laputa/assets/js/88.ef068175.js"><link rel="prefetch" href="Laputa/assets/js/89.3c86a439.js"><link rel="prefetch" href="Laputa/assets/js/90.7b4ceab8.js"><link rel="prefetch" href="Laputa/assets/js/91.993029ce.js"><link rel="prefetch" href="Laputa/assets/js/92.cd0f0552.js"><link rel="prefetch" href="Laputa/assets/js/93.2ea5e4ed.js"><link rel="prefetch" href="Laputa/assets/js/94.d77f771e.js"><link rel="prefetch" href="Laputa/assets/js/95.bfb1166d.js"><link rel="prefetch" href="Laputa/assets/js/96.d656aebb.js"><link rel="prefetch" href="Laputa/assets/js/97.8d318516.js"><link rel="prefetch" href="Laputa/assets/js/98.836a48cc.js"><link rel="prefetch" href="Laputa/assets/js/99.90560d29.js"><link rel="prefetch" href="Laputa/assets/js/100.a889b1b9.js"><link rel="prefetch" href="Laputa/assets/js/101.92c2d09f.js"><link rel="prefetch" href="Laputa/assets/js/102.41e8fe4c.js"><link rel="prefetch" href="Laputa/assets/js/103.1e7ebc3c.js"><link rel="prefetch" href="Laputa/assets/js/104.9b5e097e.js"><link rel="prefetch" href="Laputa/assets/js/105.664970bd.js"><link rel="prefetch" href="Laputa/assets/js/106.61b9108e.js"><link rel="prefetch" href="Laputa/assets/js/107.fffe8d0f.js"><link rel="prefetch" href="Laputa/assets/js/108.6ab1e942.js"><link rel="prefetch" href="Laputa/assets/js/109.df13f020.js"><link rel="prefetch" href="Laputa/assets/js/110.3ee4fa68.js"><link rel="prefetch" href="Laputa/assets/js/111.b836e8af.js"><link rel="prefetch" href="Laputa/assets/js/112.a83b7d02.js"><link rel="prefetch" href="Laputa/assets/js/113.ded87a86.js"><link rel="prefetch" href="Laputa/assets/js/114.297ad3a1.js"><link rel="prefetch" href="Laputa/assets/js/115.544749de.js"><link rel="prefetch" href="Laputa/assets/js/116.a8d4b51b.js"><link rel="prefetch" href="Laputa/assets/js/117.4f44196d.js"><link rel="prefetch" href="Laputa/assets/js/118.89df9a9d.js"><link rel="prefetch" href="Laputa/assets/js/119.2dba598a.js"><link rel="prefetch" href="Laputa/assets/js/120.fc3b4984.js"><link rel="prefetch" href="Laputa/assets/js/121.9fdd6483.js"><link rel="prefetch" href="Laputa/assets/js/122.b56010ca.js"><link rel="prefetch" href="Laputa/assets/js/123.41518099.js"><link rel="prefetch" href="Laputa/assets/js/124.2353c219.js"><link rel="prefetch" href="Laputa/assets/js/125.16055535.js"><link rel="prefetch" href="Laputa/assets/js/126.9edc34c6.js"><link rel="prefetch" href="Laputa/assets/js/128.483176b9.js"><link rel="prefetch" href="Laputa/assets/js/129.d0a84feb.js"><link rel="prefetch" href="Laputa/assets/js/130.e8a23474.js"><link rel="prefetch" href="Laputa/assets/js/131.46723320.js"><link rel="prefetch" href="Laputa/assets/js/132.a9d65b65.js"><link rel="prefetch" href="Laputa/assets/js/133.565a1e84.js"><link rel="prefetch" href="Laputa/assets/js/134.9a13e04e.js"><link rel="prefetch" href="Laputa/assets/js/135.c29729f1.js"><link rel="prefetch" href="Laputa/assets/js/136.1e528d9b.js"><link rel="prefetch" href="Laputa/assets/js/137.ae8b404d.js"><link rel="prefetch" href="Laputa/assets/js/138.be0e6cbb.js"><link rel="prefetch" href="Laputa/assets/js/139.237416e3.js"><link rel="prefetch" href="Laputa/assets/js/140.4ab9ca1a.js"><link rel="prefetch" href="Laputa/assets/js/141.74e2f092.js"><link rel="prefetch" href="Laputa/assets/js/142.0ecb3a43.js"><link rel="prefetch" href="Laputa/assets/js/143.be6d4143.js"><link rel="prefetch" href="Laputa/assets/js/144.1985fb6e.js"><link rel="prefetch" href="Laputa/assets/js/145.37a16214.js"><link rel="prefetch" href="Laputa/assets/js/146.3b54b80d.js"><link rel="prefetch" href="Laputa/assets/js/147.cd7a75ec.js"><link rel="prefetch" href="Laputa/assets/js/148.c069a727.js"><link rel="prefetch" href="Laputa/assets/js/149.31e9b53c.js"><link rel="prefetch" href="Laputa/assets/js/150.97670c74.js"><link rel="prefetch" href="Laputa/assets/js/151.ea21f131.js"><link rel="prefetch" href="Laputa/assets/js/152.7fb53639.js"><link rel="prefetch" href="Laputa/assets/js/153.fc1a3224.js"><link rel="prefetch" href="Laputa/assets/js/154.d139b199.js"><link rel="prefetch" href="Laputa/assets/js/155.d8803711.js"><link rel="prefetch" href="Laputa/assets/js/156.b5f75d9b.js"><link rel="prefetch" href="Laputa/assets/js/157.534cff67.js"><link rel="prefetch" href="Laputa/assets/js/158.507711d4.js"><link rel="prefetch" href="Laputa/assets/js/159.bbe8196f.js"><link rel="prefetch" href="Laputa/assets/js/160.01a377d7.js"><link rel="prefetch" href="Laputa/assets/js/161.df7bc156.js"><link rel="prefetch" href="Laputa/assets/js/162.4c050e9a.js"><link rel="prefetch" href="Laputa/assets/js/163.f633cfe3.js"><link rel="prefetch" href="Laputa/assets/js/164.9a7cde98.js"><link rel="prefetch" href="Laputa/assets/js/165.8383c6e0.js"><link rel="prefetch" href="Laputa/assets/js/166.84973e7b.js"><link rel="prefetch" href="Laputa/assets/js/167.139a83e5.js"><link rel="prefetch" href="Laputa/assets/js/168.b0d2bd4d.js"><link rel="prefetch" href="Laputa/assets/js/169.e800feb9.js"><link rel="prefetch" href="Laputa/assets/js/170.f9451e36.js"><link rel="prefetch" href="Laputa/assets/js/171.a83a4665.js"><link rel="prefetch" href="Laputa/assets/js/172.c211eed7.js"><link rel="prefetch" href="Laputa/assets/js/173.c3a50a74.js"><link rel="prefetch" href="Laputa/assets/js/174.eb3ff294.js"><link rel="prefetch" href="Laputa/assets/js/175.710a54ce.js"><link rel="prefetch" href="Laputa/assets/js/176.b8b0c286.js"><link rel="prefetch" href="Laputa/assets/js/177.53f441fa.js"><link rel="prefetch" href="Laputa/assets/js/178.81400b25.js"><link rel="prefetch" href="Laputa/assets/js/179.8d7755c9.js"><link rel="prefetch" href="Laputa/assets/js/180.cb1b319d.js"><link rel="prefetch" href="Laputa/assets/js/181.897fd3aa.js"><link rel="prefetch" href="Laputa/assets/js/182.5bbea4a6.js"><link rel="prefetch" href="Laputa/assets/js/183.59d5d5b7.js"><link rel="prefetch" href="Laputa/assets/js/184.7a6514a7.js"><link rel="prefetch" href="Laputa/assets/js/185.26dd8cdd.js"><link rel="prefetch" href="Laputa/assets/js/186.978c4dde.js"><link rel="prefetch" href="Laputa/assets/js/187.2ee204e3.js"><link rel="prefetch" href="Laputa/assets/js/188.29baaca4.js"><link rel="prefetch" href="Laputa/assets/js/189.fe643f03.js"><link rel="prefetch" href="Laputa/assets/js/190.dd3ce693.js"><link rel="prefetch" href="Laputa/assets/js/191.c9ffbdf3.js"><link rel="prefetch" href="Laputa/assets/js/192.402577fb.js"><link rel="prefetch" href="Laputa/assets/js/193.4278458a.js"><link rel="prefetch" href="Laputa/assets/js/194.26c0a999.js"><link rel="prefetch" href="Laputa/assets/js/195.b3bbd6f1.js"><link rel="prefetch" href="Laputa/assets/js/196.ec2775a6.js"><link rel="prefetch" href="Laputa/assets/js/197.7a1de435.js"><link rel="prefetch" href="Laputa/assets/js/198.b0d0b4b2.js"><link rel="prefetch" href="Laputa/assets/js/199.68e2f133.js"><link rel="prefetch" href="Laputa/assets/js/200.ac303e12.js"><link rel="prefetch" href="Laputa/assets/js/201.629c56c3.js"><link rel="prefetch" href="Laputa/assets/js/202.f8efe17e.js"><link rel="prefetch" href="Laputa/assets/js/203.24648560.js"><link rel="prefetch" href="Laputa/assets/js/204.413e0508.js"><link rel="prefetch" href="Laputa/assets/js/205.a575ce92.js"><link rel="prefetch" href="Laputa/assets/js/206.7c9b685e.js"><link rel="prefetch" href="Laputa/assets/js/207.1ab88c98.js"><link rel="prefetch" href="Laputa/assets/js/208.351562e6.js"><link rel="prefetch" href="Laputa/assets/js/209.1b054dd4.js"><link rel="prefetch" href="Laputa/assets/js/210.1e8ec36f.js"><link rel="prefetch" href="Laputa/assets/js/211.bd920edf.js"><link rel="prefetch" href="Laputa/assets/js/212.ebc1bea5.js"><link rel="prefetch" href="Laputa/assets/js/213.353cd010.js"><link rel="prefetch" href="Laputa/assets/js/214.4833f3e1.js"><link rel="prefetch" href="Laputa/assets/js/215.1946cb78.js"><link rel="prefetch" href="Laputa/assets/js/216.26c1e1d5.js"><link rel="prefetch" href="Laputa/assets/js/217.ba12abbd.js"><link rel="prefetch" href="Laputa/assets/js/218.4e7296f1.js"><link rel="prefetch" href="Laputa/assets/js/219.529550de.js"><link rel="prefetch" href="Laputa/assets/js/220.b8021d90.js"><link rel="prefetch" href="Laputa/assets/js/221.802a3551.js"><link rel="prefetch" href="Laputa/assets/js/222.bc0d810e.js"><link rel="prefetch" href="Laputa/assets/js/223.8cdfb2ab.js"><link rel="prefetch" href="Laputa/assets/js/224.7c4d2af9.js"><link rel="prefetch" href="Laputa/assets/js/225.3ee841fd.js"><link rel="prefetch" href="Laputa/assets/js/226.7df98d80.js"><link rel="prefetch" href="Laputa/assets/js/227.f8cf7429.js"><link rel="prefetch" href="Laputa/assets/js/228.1bbe3cd5.js"><link rel="prefetch" href="Laputa/assets/js/229.9255cc40.js"><link rel="prefetch" href="Laputa/assets/js/230.9fe34f11.js"><link rel="prefetch" href="Laputa/assets/js/231.4162b6b5.js"><link rel="prefetch" href="Laputa/assets/js/232.49ddd09a.js"><link rel="prefetch" href="Laputa/assets/js/233.7a3b967d.js"><link rel="prefetch" href="Laputa/assets/js/234.7df4ccbc.js"><link rel="prefetch" href="Laputa/assets/js/235.8439e9f2.js"><link rel="prefetch" href="Laputa/assets/js/236.3bec368c.js"><link rel="prefetch" href="Laputa/assets/js/237.159a831f.js"><link rel="prefetch" href="Laputa/assets/js/238.67f44d76.js"><link rel="prefetch" href="Laputa/assets/js/239.34b19aa7.js"><link rel="prefetch" href="Laputa/assets/js/240.cbcf457d.js"><link rel="prefetch" href="Laputa/assets/js/241.58c5bf48.js"><link rel="prefetch" href="Laputa/assets/js/242.23600eb9.js"><link rel="prefetch" href="Laputa/assets/js/243.7ed95623.js"><link rel="prefetch" href="Laputa/assets/js/244.ff6b7298.js"><link rel="prefetch" href="Laputa/assets/js/245.9cf038e8.js"><link rel="prefetch" href="Laputa/assets/js/246.fa1277bb.js"><link rel="prefetch" href="Laputa/assets/js/247.11fee991.js"><link rel="prefetch" href="Laputa/assets/js/248.3655e1e1.js"><link rel="prefetch" href="Laputa/assets/js/249.8fbd4f7c.js"><link rel="prefetch" href="Laputa/assets/js/250.85d161fa.js"><link rel="prefetch" href="Laputa/assets/js/251.481032de.js"><link rel="prefetch" href="Laputa/assets/js/252.6157489d.js"><link rel="prefetch" href="Laputa/assets/js/253.f91926ff.js"><link rel="prefetch" href="Laputa/assets/js/254.b7fad364.js"><link rel="prefetch" href="Laputa/assets/js/255.73dc5cad.js"><link rel="prefetch" href="Laputa/assets/js/256.6b658f8a.js">
    <link rel="stylesheet" href="Laputa/assets/css/0.styles.21b3d02c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Laputa/" class="home-link router-link-active"><!----> <span class="site-name">Hello VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h1 id="guzzle-promises"><a href="#guzzle-promises" aria-hidden="true" class="header-anchor">#</a> Guzzle Promises</h1> <p><a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">Promises/A+<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> implementation that handles promise
chaining and resolution iteratively, allowing for &quot;infinite&quot; promise chaining
while keeping the stack size constant. Read <a href="https://blog.domenic.me/youre-missing-the-point-of-promises/" target="_blank" rel="noopener noreferrer">this blog post<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for a general introduction to promises.</p> <ul><li><a href="#features">Features</a></li> <li><a href="#quick-start">Quick start</a></li> <li><a href="#synchronous-wait">Synchronous wait</a></li> <li><a href="#cancellation">Cancellation</a></li> <li><a href="#api">API</a> <ul><li><a href="#promise">Promise</a></li> <li><a href="#fulfilledpromise">FulfilledPromise</a></li> <li><a href="#rejectedpromise">RejectedPromise</a></li></ul></li> <li><a href="#promise-interop">Promise interop</a></li> <li><a href="#implementation-notes">Implementation notes</a></li></ul> <h1 id="features"><a href="#features" aria-hidden="true" class="header-anchor">#</a> Features</h1> <ul><li><a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">Promises/A+<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> implementation.</li> <li>Promise resolution and chaining is handled iteratively, allowing for
&quot;infinite&quot; promise chaining.</li> <li>Promises have a synchronous <code>wait</code> method.</li> <li>Promises can be cancelled.</li> <li>Works with any object that has a <code>then</code> function.</li> <li>C# style async/await coroutine promises using
<code>GuzzleHttp\Promise\coroutine()</code>.</li></ul> <h1 id="quick-start"><a href="#quick-start" aria-hidden="true" class="header-anchor">#</a> Quick start</h1> <p>A <em>promise</em> represents the eventual result of an asynchronous operation. The
primary way of interacting with a promise is through its <code>then</code> method, which
registers callbacks to receive either a promise's eventual value or the reason
why the promise cannot be fulfilled.</p> <h2 id="callbacks"><a href="#callbacks" aria-hidden="true" class="header-anchor">#</a> Callbacks</h2> <p>Callbacks are registered with the <code>then</code> method by providing an optional
<code>$onFulfilled</code> followed by an optional <code>$onRejected</code> function.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token comment">// $onFulfilled</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token single-quoted-string string">'The promise was fulfilled.'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// $onRejected</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token single-quoted-string string">'The promise was rejected.'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>Resolving</em> a promise means that you either fulfill a promise with a <em>value</em> or
reject a promise with a <em>reason</em>. Resolving a promises triggers callbacks
registered with the promises's <code>then</code> method. These callbacks are triggered
only once and in the order in which they were added.</p> <h2 id="resolving-a-promise"><a href="#resolving-a-promise" aria-hidden="true" class="header-anchor">#</a> Resolving a promise</h2> <p>Promises are fulfilled using the <code>resolve($value)</code> method. Resolving a promise
with any value other than a <code>GuzzleHttp\Promise\RejectedPromise</code> will trigger
all of the onFulfilled callbacks (resolving a promise with a rejected promise
will reject the promise and trigger the <code>$onRejected</code> callbacks).</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Return a value and don't break the chain</span>
        <span class="token keyword">return</span> <span class="token double-quoted-string string">&quot;Hello, &quot;</span> <span class="token punctuation">.</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// This then is executed after the first then and receives the value</span>
    <span class="token comment">// returned from the first then.</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resolving the promise triggers the $onFulfilled callbacks and outputs</span>
<span class="token comment">// &quot;Hello, reader&quot;.</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'reader.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="promise-forwarding"><a href="#promise-forwarding" aria-hidden="true" class="header-anchor">#</a> Promise forwarding</h2> <p>Promises can be chained one after the other. Each then in the chain is a new
promise. The return value of a promise is what's forwarded to the next
promise in the chain. Returning a promise in a <code>then</code> callback will cause the
subsequent promises in the chain to only be fulfilled when the returned promise
has been fulfilled. The next promise in the chain will be invoked with the
resolved value of the promise.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$nextPromise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$nextPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$nextPromise</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Triggers the first callback and outputs &quot;A&quot;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Triggers the second callback and outputs &quot;B&quot;</span>
<span class="token variable">$nextPromise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="promise-rejection"><a href="#promise-rejection" aria-hidden="true" class="header-anchor">#</a> Promise rejection</h2> <p>When a promise is rejected, the <code>$onRejected</code> callbacks are invoked with the
rejection reason.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$reason</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Outputs &quot;Error!&quot;</span>
</code></pre></div><h2 id="rejection-forwarding"><a href="#rejection-forwarding" aria-hidden="true" class="header-anchor">#</a> Rejection forwarding</h2> <p>If an exception is thrown in an <code>$onRejected</code> callback, subsequent
<code>$onRejected</code> callbacks are invoked with the thrown exception as the reason.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>Exception</span><span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token single-quoted-string string">'Error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also forward a rejection down the promise chain by returning a
<code>GuzzleHttp\Promise\RejectedPromise</code> in either an <code>$onFulfilled</code> or
<code>$onRejected</code> callback.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>RejectedPromise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RejectedPromise</span><span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$reason</span> <span class="token operator">===</span> <span class="token single-quoted-string string">'Error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If an exception is not thrown in a <code>$onRejected</code> callback and the callback
does not return a rejected promise, downstream <code>$onFulfilled</code> callbacks are
invoked using the value returned from the <code>$onRejected</code> callback.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>RejectedPromise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token double-quoted-string string">&quot;It's ok&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$value</span> <span class="token operator">===</span> <span class="token double-quoted-string string">&quot;It's ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="synchronous-wait"><a href="#synchronous-wait" aria-hidden="true" class="header-anchor">#</a> Synchronous wait</h1> <p>You can synchronously force promises to complete using a promise's <code>wait</code>
method. When creating a promise, you can provide a wait function that is used
to synchronously force a promise to complete. When a wait function is invoked
it is expected to deliver a value to the promise or reject the promise. If the
wait function does not deliver a value, then an exception is thrown. The wait
function provided to a promise constructor is invoked when the <code>wait</code> function
of the promise is called.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Calling wait will return the value of the promise.</span>
<span class="token keyword">echo</span> <span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// outputs &quot;foo&quot;</span>
</code></pre></div><p>If an exception is encountered while invoking the wait function of a promise,
the promise is rejected with the exception and the exception is thrown.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>Exception</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws the exception.</span>
</code></pre></div><p>Calling <code>wait</code> on a promise that has been fulfilled will not trigger the wait
function. It will simply return the previously resolved value.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'this is not called!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// outputs &quot;foo&quot;</span>
</code></pre></div><p>Calling <code>wait</code> on a promise that has been rejected will throw an exception. If
the rejection reason is an instance of <code>\Exception</code> the reason is thrown.
Otherwise, a <code>GuzzleHttp\Promise\RejectionException</code> is thrown and the reason
can be obtained by calling the <code>getReason</code> method of the exception.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>PHP Fatal error:  Uncaught exception 'GuzzleHttp\Promise\RejectionException' with message 'The promise was rejected with value: foo'</p></blockquote> <h2 id="unwrapping-a-promise"><a href="#unwrapping-a-promise" aria-hidden="true" class="header-anchor">#</a> Unwrapping a promise</h2> <p>When synchronously waiting on a promise, you are joining the state of the
promise into the current state of execution (i.e., return the value of the
promise if it was fulfilled or throw an exception if it was rejected). This is
called &quot;unwrapping&quot; the promise. Waiting on a promise will by default unwrap
the promise state.</p> <p>You can force a promise to resolve and <em>not</em> unwrap the state of the promise
by passing <code>false</code> to the first argument of the <code>wait</code> function:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// This will not throw an exception. It simply ensures the promise has</span>
<span class="token comment">// been resolved.</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When unwrapping a promise, the resolved value of the promise will be waited
upon until the unwrapped value is not a promise. This means that if you resolve
promise A with a promise B and unwrap promise A, the value returned by the
wait function will be the value delivered to promise B.</p> <p><strong>Note</strong>: when you do not unwrap the promise, no value is returned.</p> <h1 id="cancellation"><a href="#cancellation" aria-hidden="true" class="header-anchor">#</a> Cancellation</h1> <p>You can cancel a promise that has not yet been fulfilled using the <code>cancel()</code>
method of a promise. When creating a promise you can provide an optional
cancel function that when invoked cancels the action of computing a resolution
of the promise.</p> <h1 id="api"><a href="#api" aria-hidden="true" class="header-anchor">#</a> API</h1> <h2 id="promise"><a href="#promise" aria-hidden="true" class="header-anchor">#</a> Promise</h2> <p>When creating a promise object, you can provide an optional <code>$waitFn</code> and
<code>$cancelFn</code>. <code>$waitFn</code> is a function that is invoked with no arguments and is
expected to resolve the promise. <code>$cancelFn</code> is a function with no arguments
that is expected to cancel the computation of a promise. It is invoked when the
<code>cancel()</code> method of a promise is called.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'waited'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something that will cancel the promise computation (e.g., close</span>
        <span class="token comment">// a socket, cancel a database query, etc...)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assert</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'waited'</span> <span class="token operator">===</span> <span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A promise has the following methods:</p> <ul><li><p><code>then(callable $onFulfilled, callable $onRejected) : PromiseInterface</code></p> <p>Appends fulfillment and rejection handlers to the promise, and returns a new promise resolving to the return value of the called handler.</p></li> <li><p><code>otherwise(callable $onRejected) : PromiseInterface</code></p> <p>Appends a rejection handler callback to the promise, and returns a new promise resolving to the return value of the callback if it is called, or to its original fulfillment value if the promise is instead fulfilled.</p></li> <li><p><code>wait($unwrap = true) : mixed</code></p> <p>Synchronously waits on the promise to complete.</p> <p><code>$unwrap</code> controls whether or not the value of the promise is returned for a
fulfilled promise or if an exception is thrown if the promise is rejected.
This is set to <code>true</code> by default.</p></li> <li><p><code>cancel()</code></p> <p>Attempts to cancel the promise if possible. The promise being cancelled and
the parent most ancestor that has not yet been resolved will also be
cancelled. Any promises waiting on the cancelled promise to resolve will also
be cancelled.</p></li> <li><p><code>getState() : string</code></p> <p>Returns the state of the promise. One of <code>pending</code>, <code>fulfilled</code>, or
<code>rejected</code>.</p></li> <li><p><code>resolve($value)</code></p> <p>Fulfills the promise with the given <code>$value</code>.</p></li> <li><p><code>reject($reason)</code></p> <p>Rejects the promise with the given <code>$reason</code>.</p></li></ul> <h2 id="fulfilledpromise"><a href="#fulfilledpromise" aria-hidden="true" class="header-anchor">#</a> FulfilledPromise</h2> <p>A fulfilled promise can be created to represent a promise that has been
fulfilled.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>FulfilledPromise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FulfilledPromise</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Fulfilled callbacks are immediately invoked.</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="rejectedpromise"><a href="#rejectedpromise" aria-hidden="true" class="header-anchor">#</a> RejectedPromise</h2> <p>A rejected promise can be created to represent a promise that has been
rejected.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>RejectedPromise</span><span class="token punctuation">;</span>

<span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RejectedPromise</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Rejected callbacks are immediately invoked.</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$reason</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="promise-interop"><a href="#promise-interop" aria-hidden="true" class="header-anchor">#</a> Promise interop</h1> <p>This library works with foreign promises that have a <code>then</code> method. This means
you can use Guzzle promises with <a href="https://github.com/reactphp/promise" target="_blank" rel="noopener noreferrer">React promises<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for example. When a foreign promise is returned inside of a then method
callback, promise resolution will occur recursively.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Create a React promise</span>
<span class="token variable">$deferred</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">React<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Deferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$reactPromise</span> <span class="token operator">=</span> <span class="token variable">$deferred</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a Guzzle promise that is fulfilled with a React promise.</span>
<span class="token variable">$guzzlePromise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$guzzlePromise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$reactPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something something with the value...</span>
    <span class="token comment">// Return the React promise</span>
    <span class="token keyword">return</span> <span class="token variable">$reactPromise</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Please note that wait and cancel chaining is no longer possible when forwarding
a foreign promise. You will need to wrap a third-party promise with a Guzzle
promise in order to utilize wait and cancel functions with foreign promises.</p> <h2 id="event-loop-integration"><a href="#event-loop-integration" aria-hidden="true" class="header-anchor">#</a> Event Loop Integration</h2> <p>In order to keep the stack size constant, Guzzle promises are resolved
asynchronously using a task queue. When waiting on promises synchronously, the
task queue will be automatically run to ensure that the blocking promise and
any forwarded promises are resolved. When using promises asynchronously in an
event loop, you will need to run the task queue on each tick of the loop. If
you do not run the task queue, then promises will not be resolved.</p> <p>You can run the task queue using the <code>run()</code> method of the global task queue
instance.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Get the global task queue</span>
<span class="token variable">$queue</span> <span class="token operator">=</span> \<span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$queue</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For example, you could use Guzzle promises with React using a periodic timer:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$loop</span> <span class="token operator">=</span> React\<span class="token package">EventLoop<span class="token punctuation">\</span>Factory</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$loop</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addPeriodicTimer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$queue</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>TODO</em>: Perhaps adding a <code>futureTick()</code> on each tick would be faster?</p> <h1 id="implementation-notes"><a href="#implementation-notes" aria-hidden="true" class="header-anchor">#</a> Implementation notes</h1> <h2 id="promise-resolution-and-chaining-is-handled-iteratively"><a href="#promise-resolution-and-chaining-is-handled-iteratively" aria-hidden="true" class="header-anchor">#</a> Promise resolution and chaining is handled iteratively</h2> <p>By shuffling pending handlers from one owner to another, promises are
resolved iteratively, allowing for &quot;infinite&quot; then chaining.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">require</span> <span class="token single-quoted-string string">'vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">GuzzleHttp<span class="token punctuation">\</span>Promise<span class="token punctuation">\</span>Promise</span><span class="token punctuation">;</span>

<span class="token variable">$parent</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$p</span> <span class="token operator">=</span> <span class="token variable">$parent</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// The stack size remains constant (a good thing)</span>
        <span class="token keyword">echo</span> <span class="token function">xdebug_get_stack_depth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">', '</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$v</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$parent</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// int(1000)</span>

</span></code></pre></div><p>When a promise is fulfilled or rejected with a non-promise value, the promise
then takes ownership of the handlers of each child promise and delivers values
down the chain without using recursion.</p> <p>When a promise is resolved with another promise, the original promise transfers
all of its pending handlers to the new promise. When the new promise is
eventually resolved, all of the pending handlers are delivered the forwarded
value.</p> <h2 id="a-promise-is-the-deferred"><a href="#a-promise-is-the-deferred" aria-hidden="true" class="header-anchor">#</a> A promise is the deferred.</h2> <p>Some promise libraries implement promises using a deferred object to represent
a computation and a promise object to represent the delivery of the result of
the computation. This is a nice separation of computation and delivery because
consumers of the promise cannot modify the value that will be eventually
delivered.</p> <p>One side effect of being able to implement promise resolution and chaining
iteratively is that you need to be able for one promise to reach into the state
of another promise to shuffle around ownership of handlers. In order to achieve
this without making the handlers of a promise publicly mutable, a promise is
also the deferred value, allowing promises of the same parent class to reach
into and modify the private properties of promises of the same type. While this
does allow consumers of the value to modify the resolution or rejection of the
deferred, it is a small price to pay for keeping the stack size constant.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$promise</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// The promise is the deferred value, so you can deliver a value to it.</span>
<span class="token variable">$promise</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints &quot;foo&quot;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="Laputa/assets/js/47.53bc0ff4.js" defer></script><script src="Laputa/assets/js/app.6f999ec1.js" defer></script>
  </body>
</html>
